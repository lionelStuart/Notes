监控系统包括metric、log和trace

以metric和log为中心，trace做上下游微服务关联

## metrics

metric按角色可分为运维和应用层两个场景，两者关注的指标有差异：

运维更关注从机器-》资源-》服务的使用率状态，如机器和服务维度CPU、MEM、IO、DISK和各服务存活状态、资源使用情况

应用层关注SLA、耗时、QPS和一些特定业务的打点统计数据

实时的
metrics数据可以分为推拉两种形式，如普罗米修斯拉数据，可以看作定期采样，不适合精确度要求高的场景

数值要求高的metrics应该用推数据


## log

存储日志利用，可以做trace故障分析，也可以做OLTP。OLTP场景做天级分析也可实现metrics的部分功能，做汇聚报表。做trace分析则需要结合trace组件功能，也需要metrics做入口。

log的使用场景更丰富，使用趋向是metric+log+trace合一



# 学习内容

# 普罗米修斯和grafana

1. 普罗米修斯和grafana的搭建
- 普罗修斯配置、定期任务、服务端口、UI
- 定义持久化存储

2. mysql、node接入普罗米修斯监控
- 定义数据源
- 接入exporter
- 导入dashboard


3. 服务自定义监控接入普罗米修斯
- 定义定时任务
- API开发


# 链路追踪、skywalking、EFK
1. 创建Elastic和kibana，打开前端页面

2. 从golang程序写支持elastic解析的日志

3. 配置filebeat通用模板，以sidecar接入golang程序

4. 配置kibana界面，日志导入成功

5. 关注点
    - 以https模式接入filebeat配置校验为false
    - docker CMD指令不能直接使用重定向符号，需要用脚本支持
    - 边车中指定的路径需要一致
    - filebeat可以用指令测试配置和输出是否正确
